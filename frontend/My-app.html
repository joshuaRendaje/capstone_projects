<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Oyster AI Futuristic Dashboard</title>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Tailwind CSS -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">

  <style>
    /* General Theme */
    body {
      background: linear-gradient(135deg,#0f172a 0%,#1e293b 100%);
      font-family: 'Inter', sans-serif;
      color: white;
    }
    h1 {
      font-size: 3rem;
      text-align:center;
      font-weight:900;
      background: linear-gradient(90deg,#a855f7,#ec4899,#f87171);
      -webkit-background-clip: text;
      background-clip:text;
      -webkit-text-fill-color:transparent;
      margin-bottom:2rem;
    }
    canvas { max-height: 400px; }

    /* Cards Section */
    #live-cards {
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:24px;
      margin-top:20px;
    }
    .card {
      width:160px;
      height:160px;
      background:rgba(30,41,59,0.75);
      backdrop-filter:blur(12px);
      border:1px solid rgba(255,255,255,0.15);
      box-shadow:0 6px 25px rgba(0,0,0,0.5);
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      border-radius:1rem;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: scale(1.08);
      box-shadow:0 8px 35px rgba(255,255,255,0.25);
    }
    .status-badge {
      display:inline-block;
      padding:3px 8px;
      border-radius:9999px;
      font-size:0.7rem;
      font-weight:700;
      margin-top:6px;
      text-align:center;
    }
    #last-updated {
      text-align:center;
      font-size:0.875rem;
      color:#cbd5e1;
      margin-top:1.5rem;
    }

    /* Tabs */
    .tab { cursor:pointer; padding:10px 20px; border-bottom:2px solid transparent; transition:all 0.3s; font-weight:600; }
    .tab-active { border-color:#f87171; color:#f87171; }
    .tab-content { display:none; }
    .tab-content-active { display:block; }

    /* Table */
    .table-container { overflow-x:auto; }
    table { width:100%; border-collapse:collapse; min-width:600px; }
    th,td { padding:12px; border-bottom:1px solid rgba(255,255,255,0.2); text-align:left; }
    th { color:#f87171; }
    td { color:#fff; }
  </style>
</head>
<body>

<h1>Oyster AI Futuristic Dashboard</h1>

<!-- Tabs -->
<div class="flex justify-end gap-4 mb-6 px-6">
  <div class="tab tab-active" data-tab="live">Live Dashboard</div>
  <div class="tab" data-tab="stats">Statistic Record</div>
</div>

<!-- Live Dashboard Tab -->
<div id="live" class="tab-content tab-content-active">
  <!-- Real-time Line Chart -->
  <div class="bg-gray-800 rounded-3xl shadow-2xl p-6 mb-8 border border-gray-700">
    <canvas id="lineChart"></canvas>
  </div>

  <!-- Live Cards -->
  <div id="live-cards"></div>
  <p id="last-updated">‚è± Last updated: --</p>
</div>

<!-- Historical Statistics Tab -->
<div id="stats" class="tab-content">
  <div class="bg-gray-800 rounded-3xl shadow-2xl p-6 border border-gray-700">
    <h2 class="text-xl font-bold mb-4 text-pink-400">Historical Statistic Records</h2>

    <!-- Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Temperature (¬∞C)</th>
            <th>TDS</th>
            <th>Turbidity (NTU)</th>
          </tr>
        </thead>
        <tbody id="stats-table-body"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
  /* =====================
     TAB SWITCHING LOGIC
  ===================== */
  const tabs=document.querySelectorAll(".tab");
  const contents=document.querySelectorAll(".tab-content");
  tabs.forEach(tab=>tab.addEventListener("click",()=>{
    tabs.forEach(t=>t.classList.remove("tab-active"));
    tab.classList.add("tab-active");
    contents.forEach(c=>c.classList.remove("tab-content-active"));
    document.getElementById(tab.dataset.tab).classList.add("tab-content-active");
  }));

  /* =====================
     FIREBASE CONFIG
  ===================== */
  const firebaseConfig={
    apiKey:"AIzaSyCjTkCAgC8l9PUiFIeWXpy2S2nH7foJHX8",
    authDomain:"trial-reading.firebaseapp.com",
    databaseURL:"https://trial-reading-default-rtdb.europe-west1.firebasedatabase.app",
    projectId:"trial-reading",
    storageBucket:"trial-reading.firebasestorage.app",
    messagingSenderId:"541548808372",
    appId:"1:541548808372:web:773b8f8cac50b0e4c2afe1"
  };
  firebase.initializeApp(firebaseConfig);
  const dbRef=firebase.database().ref("trial_Reading");

  /* =====================
     CHART CONFIG
  ===================== */
  const ctx=document.getElementById('lineChart').getContext('2d');

  // Gradient backgrounds
  const gradientTemp=ctx.createLinearGradient(0,0,0,400);
  gradientTemp.addColorStop(0,'rgba(248,113,113,0.5)');
  gradientTemp.addColorStop(1,'rgba(248,113,113,0.1)');

  const gradientTDS=ctx.createLinearGradient(0,0,0,400);
  gradientTDS.addColorStop(0,'rgba(52,211,153,0.5)');
  gradientTDS.addColorStop(1,'rgba(52,211,153,0.1)');

  const gradientTurb=ctx.createLinearGradient(0,0,0,400);
  gradientTurb.addColorStop(0,'rgba(251,191,36,0.5)');
  gradientTurb.addColorStop(1,'rgba(251,191,36,0.1)');

  // Line chart setup
  const lineChart=new Chart(ctx,{
    type:'line',
    data:{ labels:[], datasets:[
      { label:"üå° Temperature (¬∞C)", data:[], borderColor:"#f87171", backgroundColor:gradientTemp, fill:true, tension:0.4, pointStyle:'circle', pointRadius:6, pointHoverRadius:8, yAxisID:'y1', borderWidth:3 },
      { label:"üíß TDS", data:[], borderColor:"#34d399", backgroundColor:gradientTDS, fill:true, tension:0.4, pointStyle:'rect', pointRadius:6, pointHoverRadius:8, yAxisID:'y1', borderWidth:3 },
      { label:"üåä Turbidity (NTU)", data:[], borderColor:"#fbbf24", backgroundColor:gradientTurb, fill:true, tension:0.4, pointStyle:'triangle', pointRadius:6, pointHoverRadius:8, yAxisID:'y2', borderWidth:3 }
    ]},
    options:{
      responsive:true,
      interaction:{ mode:'nearest', intersect:false },
      animation:{ duration:1200, easing:'easeOutQuart' },
      plugins:{ legend:{ labels:{ color:'#fff', font:{ size:14 } } }, tooltip:{ mode:'nearest', intersect:false } },
      scales:{
        x:{ title:{ display:true, text:"Timestamp", color:"#aaa", font:{ size:14 } }, ticks:{ color:"#aaa" }, grid:{ color:'rgba(255,255,255,0.1)'}},
        y1:{ type:'linear', position:'left', title:{ display:true, text:"Temp & TDS", color:"#aaa", font:{ size:14 } }, ticks:{ color:"#aaa" }, grid:{ color:'rgba(255,255,255,0.1)'}},
        y2:{ type:'linear', position:'right', title:{ display:true, text:"Turbidity (0‚Äì100 NTU)", color:"#fbbf24", font:{ size:14 } }, min:0, max:100, ticks:{ color:"#fbbf24" }, grid:{ drawOnChartArea:false }}
      }
    }
  });

  /* =====================
     COUNTER ANIMATION FOR CARDS
  ===================== */
  function animateValue(el, start, end, duration){
    let startTime=null;
    function animate(currentTime){
      if(!startTime) startTime=currentTime;
      const progress=Math.min((currentTime-startTime)/duration,1);
      el.textContent=(start+(end-start)*progress).toFixed(1);
      if(progress<1) requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);
  }

  /* =====================
     RENDER LIVE CARDS
  ===================== */
  function renderCards(latest){
    const container=document.getElementById("live-cards");
    container.innerHTML=""; // Clear old cards

    // Handle turbidity field (may vary in DB)
    const turbidityValue=latest.turbidity_ntu??latest.turbidity_voltage??latest.turbidity_raw??"--";

    const cards=[
      {label:"üå° Temperature (¬∞C)", value:latest.temperature, status:latest.temperature_status},
      {label:"üíß TDS", value:latest.tds, status:latest.tds_status},
      {label:"üåä Turbidity (NTU)", value:turbidityValue, status:latest.turbidity_status}
    ];

    // Create card elements dynamically
    cards.forEach(card=>{
      const div=document.createElement("div");
      div.className="card";
      div.innerHTML=`<p class="text-sm text-gray-400 mb-2">${card.label}</p>
        <p class="text-3xl font-extrabold text-green-400 value">0</p>
        <span class="status-badge ${card.status?.includes('‚ùå')?'bg-red-400':card.status?.includes('‚ö†Ô∏è')?'bg-yellow-400':'bg-green-400'}">${card.status??"--"}</span>`;
      container.appendChild(div);

      // Animate value count
      const valueEl=div.querySelector(".value");
      if(!isNaN(card.value)){
        animateValue(valueEl,0,parseFloat(card.value),1000);
      } else {
        valueEl.textContent=card.value;
      }
    });
  }

  /* =====================
     RENDER HISTORICAL TABLE (LIMIT 10)
  ===================== */
  function renderStatsTable(entries){
    const tbody=document.getElementById("stats-table-body");
    tbody.innerHTML="";
    const newest10=entries.slice(-10).reverse(); // Get latest 10 readings
    newest10.forEach(e=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${e.timestamp}</td>
        <td>${e.temperature}</td>
        <td>${e.tds}</td>
        <td>${e.turbidity_ntu??e.turbidity_voltage??e.turbidity_raw??"--"}</td>`;
      tbody.appendChild(tr);
    });
  }

  /* =====================
     FETCH & UPDATE DATA
  ===================== */
  function fetchLatestReadings(){
    dbRef.orderByChild("timestamp").limitToLast(50).once("value",snapshot=>{
      const data=snapshot.val();
      if(!data) return;

      // Convert object ‚Üí sorted array by timestamp
      const entries=Object.values(data).sort((a,b)=>new Date(a.timestamp)-new Date(b.timestamp));

      // Last 10 readings for chart
      const last10=entries.slice(-10);
      lineChart.data.labels=last10.map(e=>e.timestamp);
      lineChart.data.datasets[0].data=last10.map(e=>e.temperature);
      lineChart.data.datasets[1].data=last10.map(e=>e.tds);
      lineChart.data.datasets[2].data=last10.map(e=>e.turbidity_ntu??e.turbidity_voltage??e.turbidity_raw??0);
      lineChart.update();

      // Latest card display
      const latest=entries[entries.length-1];
      renderCards(latest);

      // Update timestamp
      document.getElementById("last-updated").textContent=`‚è± Last updated: ${latest.timestamp}`;

      // Render 10 newest historical records
      renderStatsTable(entries);
    });
  }

  // Run once, then auto-refresh every 15s
  fetchLatestReadings();
  setInterval(fetchLatestReadings,15000);
</script>
</body>
</html>
